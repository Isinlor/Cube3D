<canvas id="canvas1" width="500" height="500"></canvas>
<script>
// function setPixel(imageData, x, y, rgb=[0,0,0], a = 255) {
//     index = (x + y * imageData.width) * 4;
//     imageData.data[index+0] = rgb[0];
//     imageData.data[index+1] = rgb[1];
//     imageData.data[index+2] = rgb[2];
//     imageData.data[index+3] = a;
//     return;
// }
function drawLine(A, B) {
	// if (B.y == A.y && B.x == A.x) {
    //    	setPixel(imageData, B.y, B.x);
	// } else {
	// 	var dx = A.y - B.y; 
	// 	var sx = (dx < 0) ? -1 : 1;
	// 	var dy = A.x - B.x; 
	// 	var sy = (dy < 0) ? -1 : 1;

	// 	if (Math.abs(dy) < Math.abs(dx))
	// 	{    
	// 	    var a = dy / dx;
	// 	    var b = B.x - a * B.y;
	// 	    var i = B.y;
	// 	    while (i != A.y)
	// 	    {
	// 	        setPixel(imageData, Math.round(a*i + b), i);
	// 	        i += sx;
	// 	    }
	// 	} 
	// 	else 
	// 	{
	// 	    var a = dx / dy;
	// 	    var b = B.y - a * B.x;
	// 	    var i = B.x;
	// 	    while (i != A.x)
	// 	    {
	// 	        setPixel(imageData, i, Math.round(a*i + b));
	// 	        i += sy;
	// 	    }    
	// 	}
	// }
	// return;
	c.beginPath();
	c.moveTo(A.x,A.y);
	c.lineTo(B.x,B.y);
	c.stroke();
}

function reset () {
 	//imageData = c.createImageData(imageData);
 	 c.clearRect(0,0,400,400); 
}
function draw () {
	reset();
	var A = new point(200, 200);
	var B = new point(300, 300);
	var C = new point(300, 200);
	var ABC = new triangle(A, B, C);
	var cen = ABC.getCenter();
	setPixel(imageData, cen.x, cen.y);
	ABC.rotate(cen, n);
	ABC.draw();
	//c.putImageData(imageData, 0, 0);
	n += 0.1;
}
function draw3d () {
	reset();
	var A = new point3d(150, 150, 150);
	 m = new cube(A, 150);
	 m.spine('y', n);
	 m.spine('x', n*0.2);
	 m.draw();

	//c.putImageData(imageData, 0, 0);
	n += 0.01;
}
element = document.getElementById("canvas1");
c = element.getContext("2d");

var point3d = function point3d (x, y, z) {
	this.x = x;
	this.y = y;
	this.z = z;
}

point3d.prototype = {
	rotateAroundAxis: function(axis, center, theta) {
		var coordName1 = '',
			coordName2 = '',
			point2d = new point();
		switch (axis) {
			case axis = 'x':
				coordName1 = 'y';
				coordName2 = 'z';
				break;
			case axis = 'y':
				coordName1 = 'z';
				coordName2 = 'x';
				break;
			case axis = 'z':
				coordName1 = 'x';
				coordName2 = 'y';
				break;

		}
		point2d = this.projectionOn(coordName1, coordName2);
		point2d.rotate(center, theta);
		this[coordName1] = point2d.x;
		this[coordName2] = point2d.y;

	},
	translate: function(x, y, z) {
		this.x += x;
		this.y += y;
		this.z += z;
	},
	round: function() {

	},
	projectionOn: function (axis1, axis2) {
		return new point(this[axis1], this[axis2]);
	}
}

var point = function point (x, y) {
	this.x = x;
	this.y = y;
}

point.prototype = {
	rotate: function (center, theta) {
		var cosTheta = Math.cos(theta);
		var sinTheta = Math.sin(theta);
		this.translate(-center.x, -center.y);
	    var p0 = this.x*cosTheta-this.y*sinTheta;
	    var p1 = this.x*sinTheta+this.y*cosTheta;
		this.x = p0;
		this.y = p1;
		this.round();
		this.translate(center.x, center.y);
	},
	translate: function (x, y) {
		this.x += x;
		this.y += y;
	},
	round: function() {
		this.x = Math.round(this.x);
		this.y = Math.round(this.y);
	},
	draw: function() {
		setPixel(imageData, this.x, this.y);
	}
}

var triangle = function triangle (A, B, C) {
	this.A = A;
	this.B = B;
	this.C = C;
}
triangle.prototype = { 
	rotate: function(center, theta) {
		this.A.rotate(center, theta);
		this.B.rotate(center, theta);
		this.C.rotate(center, theta);
	},
	translate: function(x, y) {
		this.A.translate(x, y);
		this.B.translate(x, y);
		this.C.translate(x, y);
	},
	draw: function() {
		drawLine(this.A, this.B);
		drawLine(this.B, this.C);
		drawLine(this.C, this.A);
	},
	getCenter: function() {
		var center = new point();
		center.x = (this.A.x + this.B.x + this.C.x)/3;
		center.y = (this.A.y + this.B.y + this.C.y)/3;
		center.round();
		return center;
	}
}

var cube = function cube (A, a) {
	this.a = a;
	this.vertex = new Array();
	this.vertex2d = new Array();
	this.vertex[0] = A;
	this.vertex[1] = new point3d(A.x+a, A.y, A.z);
	this.vertex[2] = new point3d(A.x, A.y+a, A.z);
	this.vertex[3] = new point3d(A.x, A.y, A.z+a);
	this.vertex[4] = new point3d(A.x+a, A.y+a, A.z);
	this.vertex[5] = new point3d(A.x+a, A.y, A.z+a);
	this.vertex[6] = new point3d(A.x, A.y+a, A.z+a);
	this.vertex[7] = new point3d(A.x+a, A.y+a, A.z+a);

	this.center = new point3d();
	this.center.x = this.vertex[0].x + this.a/2;
	this.center.y = this.vertex[0].y + this.a/2;
	this.center.z = this.vertex[0].z + this.a/2;
}

cube.prototype = {
	translate: function (x, y, z) {
		for (var i = this.vertex.length - 1; i >= 0; i--) {
			this.vertex[i].x += x;
			this.vertex[i].y += y;
			this.vertex[i].z += z;
		};
	},
	spine: function(axis, theta) {
		var center2d = new point(),
			projection = new point(),
			coordName1 = '',
			coordName2 = '';
		switch (axis) {
			case axis = 'x':
				coordName1 = 'y';
				coordName2 = 'z';
				break;
			case axis = 'y':
				coordName1 = 'z';
				coordName2 = 'x';
				break;
			case axis = 'z':
				coordName1 = 'x';
				coordName2 = 'y';
				break;

		}
		center2d = this.center.projectionOn(coordName1, coordName2);
		for (var i = this.vertex.length - 1; i >= 0; i--) {
			this.vertex[i].rotateAroundAxis(axis, center2d, theta);
		};
	},
	projectionOn: function (axis1, axis2) {
		for (var i = this.vertex.length - 1; i >= 0; i--) {
			this.vertex2d[i] = this.vertex[i].projectionOn(axis1, axis2);
		};
	},
	draw: function() {
		this.projectionOn('x', 'y');
		drawLine(this.vertex2d[0], this.vertex2d[1]);
		drawLine(this.vertex2d[0], this.vertex2d[2]);
		drawLine(this.vertex2d[0], this.vertex2d[3]);

		drawLine(this.vertex2d[1], this.vertex2d[4]);
		drawLine(this.vertex2d[1], this.vertex2d[5]);

		drawLine(this.vertex2d[2], this.vertex2d[4]);
		drawLine(this.vertex2d[2], this.vertex2d[6]);

		drawLine(this.vertex2d[3], this.vertex2d[5]);
		drawLine(this.vertex2d[3], this.vertex2d[6]);

		drawLine(this.vertex2d[4], this.vertex2d[7]);

		drawLine(this.vertex2d[5], this.vertex2d[7]);

		drawLine(this.vertex2d[6], this.vertex2d[7]);

	}
}

var line = function line (A, B) {
	this.A = A;
	this.B = B;
	this.a = (this.A.y - this.B.y) / (this.A.x - this.B.x);
	this.b = this.B.y - this.a*this.B.x;
}

line.prototype = {
	draw: function() {
		drawLine(this.A, this.B);
	},
	getXfromY: function(y){

	},
	getYfromX: function(x){
		var max = Math.max(this.A.x, this.B.x);
		var min = Math.min(this.A.x, this.B.x);
		console.log(max, min);
		console.log(this.a, this.b);
		if (x>=min && x<=max) {
			return this.a*x + this.b;
		}
	}

}

var surface = function surface () {
	this.points = new Array();
	this.lines = new Array();
}

surface.prototype = {
	setLine: function (A, B) {
		var line_t = new line(A, B);
		this.lines.push(line_t);
	},
	setPoint: function(A) {
		this.points.push(A);
	},
	isPointVisible: function(A) {
		 for (var i = this.lines.length - 1; i >= 0; i--) {
		 	console.log(this.lines[i].getYfromX(A.x), A.y);
		 	if (this.lines[i].getYfromX(A.x) >= A.y) {
		 		return false;
		 	}
		// 	if(A.y>this.lines[i].A.y && A.y>this.lines[i].B.y){
		// 		if(A.x>this.lines[i].A.x && A.x<this.lines[i].B.y){
		// 			return false;
		// 		}
		// 		if(A.x<this.lines[i].A.x && A.x>this.lines[i].B.y){
		// 			return false;
		// 		}
		// 	}
		// 	if(A.y<this.lines[i].A.y && A.y<this.lines[i].B.y){
		// 		if(A.x>this.lines[i].A.x && A.x<this.lines[i].B.y){
		// 			return false;
		// 		}
		// 		if(A.x<this.lines[i].A.x && A.x>this.lines[i].B.y){
		// 			return false;
		// 		}
		// 	}
		};
		return true;
	},
	draw: function() {
		for (var i = this.points.length - 1; i >= 0; i--) {
			this.points[i].draw();
		};
		for (var i = this.lines.length - 1; i >= 0; i--) {
			this.lines[i].draw();
		};
	}
}
// read the width and height of the canvas
width = element.width;
height = element.height;

// create a new pixel array
imageData = c.createImageData(width, height);

var n = 0;

// 2D stuffs
// var A = new point(200, 200);
// var B = new point(300, 300);
// var C = new point(300, 200);
// var ABC = new triangle(A, B, C);
// var cen = ABC.getCenter();
// //setPixel(imageData, cen.x, cen.y);
// ABC.rotate(cen, 3);
// //ABC.draw();

// 3D stuffs
var A = new point3d(200, 200, 200);
var m = new cube(A, 100);
m.spine('y', 1);
m.spine('x', 1);
m.draw();
setInterval(draw3d, 1000/30);
// setInterval(draw, 1000/25);



// 2D visibility test

function testDraw () {
	reset();
	var A = new point(240, 200);
	var B = new point(340, 300);
	var A2 = new point(120, 120);
	var B2 = new point(300, 120);
	var C = new point(350, 350);
	var plane = new surface();
	var cen = new point(250, 250);
	C.rotate(cen, n);
	//plane.setLine(A, B);
	plane.setLine(A2, B2);
	plane.setPoint(C);
	is = plane.isPointVisible(C);
	console.log(is);
	plane.draw();
	c.putImageData(imageData, 0, 0);
	n += 0.1;
}
	var A2 = new point(100, 100);
	var B2 = new point(300, 100);
var A = new point(200, 200);
var B = new point(300, 300);
var C = new point(299, 199);

 // var AB = new line(A, B);
 // console.log(AB.getYfromX(199), "AB");

//  var AB2 = new line(A2, B2);
//  console.log(AB2.getYfromX(199), "AB2");

// var plane = new surface();
// console.log('surface');
// plane.setLine(A, B);
// plane.setPoint(C);
// plane.draw();
// setInterval(testDraw, 1000/5);

// copy the image data back onto the canvas
//c.putImageData(imageData, 0, 0); // at coords 0,0
</script>